# ViT TensorRT - ç®€åŒ–ç‰ˆ Makefile (ä»…ç¼–è¯‘)

CXX = g++
TARGET_BUILDER = vit_builder
TARGET_RUNTIME = vit_runtime

# ç¼–è¯‘å™¨æ ‡å¿—
CXXFLAGS = -std=c++14 -O3 -DNDEBUG -Wall -Wextra -Wno-deprecated-declarations

# å¤´æ–‡ä»¶è·¯å¾„
INCLUDES = -I/usr/include/aarch64-linux-gnu \
           -I/usr/local/cuda/include \
           -I/usr/include/opencv4

# åº“æ–‡ä»¶è·¯å¾„
LDFLAGS = -L/usr/lib/aarch64-linux-gnu \
          -L/usr/local/cuda/lib64

# é“¾æ¥åº“
LIBS = -lnvinfer \
       -lcudart \
       -lopencv_core \
       -lopencv_imgproc \
       -lopencv_imgcodecs \
       -lopencv_highgui \
       -lopencv_dnn \
       -lstdc++ \
       -lpthread

# æºæ–‡ä»¶
BUILDER_SOURCE = vit_builder.cpp
RUNTIME_SOURCE = vit_runtime.cpp

# é»˜è®¤ç›®æ ‡ï¼šç¼–è¯‘ä¸¤ä¸ªå¯æ‰§è¡Œæ–‡ä»¶
all: $(TARGET_BUILDER) $(TARGET_RUNTIME)
	@echo "âœ… ç¼–è¯‘å®Œæˆï¼"

# ç¼–è¯‘ builder
$(TARGET_BUILDER): $(BUILDER_SOURCE)
	@echo "=== æ­£åœ¨ç¼–è¯‘ $(TARGET_BUILDER) ==="
	$(CXX) $(CXXFLAGS) $(INCLUDES) $(BUILDER_SOURCE) $(LDFLAGS) $(LIBS) -o $(TARGET_BUILDER)
	@echo "âœ… $(TARGET_BUILDER) ç¼–è¯‘å®Œæˆ"

# ç¼–è¯‘ runtime
$(TARGET_RUNTIME): $(RUNTIME_SOURCE)
	@echo "=== æ­£åœ¨ç¼–è¯‘ $(TARGET_RUNTIME) ==="
	$(CXX) $(CXXFLAGS) $(INCLUDES) $(RUNTIME_SOURCE) $(LDFLAGS) $(LIBS) -o $(TARGET_RUNTIME)
	@echo "âœ… $(TARGET_RUNTIME) ç¼–è¯‘å®Œæˆ"

# æ¸…ç†ç¼–è¯‘äº§ç‰©
clean:
	@echo "=== æ¸…ç†ç¼–è¯‘æ–‡ä»¶ ==="
	rm -f $(TARGET_BUILDER) $(TARGET_RUNTIME)
	@echo "âœ… æ¸…ç†å®Œæˆ"

# å¸®åŠ©ä¿¡æ¯
help:
	@echo "======================================================================"
	@echo "ViT TensorRT - ç®€åŒ–ç‰ˆ Makefile"
	@echo "======================================================================"
	@echo ""
	@echo "ğŸ“‹ å¯ç”¨ç›®æ ‡ï¼š"
	@echo "  make         - ç¼–è¯‘ vit_builder å’Œ vit_runtime (é»˜è®¤)"
	@echo "  make clean   - æ¸…ç†ç¼–è¯‘äº§ç‰©"
	@echo "  make help    - æ˜¾ç¤ºæ­¤å¸®åŠ©ä¿¡æ¯"
	@echo ""
	@echo "ğŸ”§ ç¼–è¯‘è¾“å‡ºï¼š"
	@echo "  vit_builder  - ç”¨äºæ„å»º TensorRT å¼•æ“"
	@echo "  vit_runtime  - ç”¨äºè¿è¡Œæ¨ç†"
	@echo ""
	@echo "ğŸ“ ä½¿ç”¨ç¤ºä¾‹ï¼š"
	@echo "  1. ç¼–è¯‘ï¼šmake"
	@echo "  2. æ„å»ºå¼•æ“ï¼š./vit_builder <wts_file> <engine_file> <type>"
	@echo "  3. è¿è¡Œæ¨ç†ï¼š./vit_runtime <engine_file> <image_file>"
	@echo ""
	@echo "======================================================================"

.PHONY: all clean help
